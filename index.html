<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ®</text></svg>" />
  <script>
    (function initializeAppViewportUnit() {
      const getVV = () => ({
        width: (window.visualViewport && typeof window.visualViewport.width === 'number') ? window.visualViewport.width : window.innerWidth,
        height: (window.visualViewport && typeof window.visualViewport.height === 'number') ? window.visualViewport.height : window.innerHeight
      });
      const setAppVh = () => {
        const { width, height } = getVV();
        document.documentElement.style.setProperty('--app-vh', (height * 0.01) + 'px');
        document.documentElement.style.setProperty('--vvh', height + 'px');
        document.documentElement.style.setProperty('--vvw', width + 'px');
      };
      // Initial set after DOM is interactive to avoid zero heights
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setAppVh, { once: true });
      } else {
        setAppVh();
      }
      // Update on viewport changes
      window.addEventListener('resize', setAppVh, { passive: true });
      window.addEventListener('orientationchange', setAppVh);
      window.addEventListener('pageshow', function (e) { if (e.persisted) setAppVh(); });
      document.addEventListener('visibilitychange', function () { if (!document.hidden) setAppVh(); });
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', setAppVh, { passive: true });
        window.visualViewport.addEventListener('scroll', setAppVh, { passive: true });
      }
    })();
  </script>
  <title>SuiTwo - Modular CSS Test</title>
  
  <!-- Modular CSS System -->
  <!-- All CSS loading handled by device detection -->
  <!-- Device Detection and CSS Loading -->
  <script src="src/game/systems/device/device-detection.js"></script>
  <script src="src/game/systems/device/css-loader.js"></script>
  <script src="src/game/systems/device/footer-loader.js"></script>
  
  <!-- Device Detection Verification -->
  <script>
    // Log device detection info to console only (no visual display)
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const deviceType = DeviceDetection.detectDeviceType();
        console.log('=== DEVICE DETECTION VERIFICATION ===');
        console.log('Device Type:', deviceType);
        console.log('Screen Size:', window.screen.width + 'x' + window.screen.height);
        console.log('Touch Support:', 'ontouchstart' in window);
        console.log('User Agent Mobile:', navigator.userAgent.includes('Mobile'));
        console.log('Loaded CSS Files:', document.querySelectorAll('link[rel="stylesheet"]').length);
        console.log('=====================================');
      }, 1000); // Wait 1 second for CSS to load
    });
  </script>

  <!-- Responsive modules - loaded last -->
  <!-- Note: css-loader.js and device-detection.js already loaded in <head>, don't load again -->
</head>
<body>
  <!-- Main Viewport Container -->
  <div class="viewport-container">
    <!-- Front Page Overlay -->
    <div id="frontPage" class="front-page-overlay front-page-overlay-visible">
      <div class="front-page-content">
        <h1 class="game-title"><img src="assets/SuiTwo_Profile.webp" alt="SuiTwo" class="title-profile-image"> SuiTwo</h1>
        <p class="game-subtitle">Market Shooter Alpha v0.1</p>
        <div class="game-description">
          <p>Fight against the negative forces of the market chart! Defeat bearish enemies and dodge downward projectiles!</p>
          <p>Use MOUSE to move and P to pause. Auto-fire is enabled!</p>
        </div>
        <button id="enterGameBtn" class="enter-game-btn">
          ğŸ® Enter Game
        </button>
        <div class="audio-note">
          <small>ğŸ”Š Audio will start after clicking Enter</small>
        </div>
      </div>
    </div>

    <!-- Game Container (lazy loaded with visibility toggle) -->
    <div class="game-container game-container-hidden">
      <!-- Enhanced Top information bar (only visible during game) -->
      <header class="game-header">
        <div class="title">
          <img src="assets/SuiTwo_Profile.webp" alt="SuiTwo" class="header-logo"> SuiTwo
          <span class="alpha-badge">Alpha v0.1</span>
        </div>
        <div class="stats">
          <div class="stat">
            <span class="stat-icon">ğŸ“</span>
            Distance: <span id="distance">0</span> m
          </div>
          <div class="stat">
            <span class="stat-icon">ğŸª™</span>
            Coins: <span id="coins">0</span>
          </div>
          <div class="stat">
            <span class="stat-icon">âš¡</span>
            Status: <span id="status">Ready</span>
          </div>
        </div>
      </header>

      <!-- Gameplay Area -->
      <div class="gameplay-area">
        <!-- Game canvas -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- In-game UI - Side-by-side with canvas -->
        <div class="game-ui-overlay">
          <div class="game-stats-panel">
            <div class="stat-item">
              <span class="stat-label">Score:</span>
              <span class="stat-value" id="gameScore">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Magic Orb Level:</span>
              <span class="stat-value" id="orbLevel">1</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Tier:</span>
              <span class="stat-value" id="gameTier">1</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Bosses Defeated:</span>
              <span class="stat-value" id="bossesDefeated">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Force Field:</span>
              <span class="stat-value" id="forceFieldLevel">None</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Coin Streak:</span>
              <span class="stat-value" id="coinStreak">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer will be loaded dynamically by footer-loader.js for desktop/tablet only -->
      <!-- For mobile, footer is not needed and will not be inserted -->
    </div>

  <!-- Main Menu Overlay -->
  <div class="main-menu-overlay main-menu-overlay-hidden" id="mainMenuOverlay">
    <div class="main-menu-content">
      <div class="game-title">
        <h1><img src="assets/SuiTwo_Profile.webp" alt="SuiTwo" class="title-profile-image"> SuiTwo</h1>
        <div class="version-badge">Alpha v0.1</div>
      </div>
      
      <div class="menu-buttons">
        <!-- Wallet Connection Section -->
        <div class="wallet-connection-section" id="walletConnectionSection">
          <div class="wallet-requirements-notice" id="walletRequirementsNotice" style="background: rgba(255, 193, 7, 0.1); border: 2px solid rgba(255, 193, 7, 0.5); border-radius: 8px; padding: 12px; margin-bottom: 12px; display: block;">
            <p class="requirements-title" style="margin: 0 0 8px 0; font-weight: bold; color: #ffc107; font-size: 14px;">âš ï¸ Requirements to Play:</p>
            <ul class="requirements-list" style="margin: 0; padding-left: 20px; list-style: none;">
              <li id="walletRequirement" style="margin: 4px 0; font-size: 13px;">ğŸ”— Connect your Sui wallet (Slush, Sui Wallet, Surf, Suiet, Ethos, OKX, Phantom, Klever, Trust, Coinbase, or any Sui-compatible wallet)</li>
              <li id="mewsRequirement" style="margin: 4px 0; font-size: 13px;">ğŸ’° Have at least 500,000 $MEWS tokens</li>
            </ul>
          </div>
          <div class="wallet-status" id="walletStatus">
            <div class="wallet-status-text" id="walletStatusText">
              <span class="wallet-icon">ğŸ”’</span>
              <span>Connect Slush Wallet to play</span>
            </div>
          </div>
          <button class="menu-btn wallet-btn" id="connectWalletBtn" onclick="handleConnectWallet()" onmouseover="playMenuHoverSound()">
            <span class="btn-icon">ğŸ”—</span>
            <span id="connectWalletBtnText">Connect Wallet</span>
          </button>
          <div class="wallet-address-display" id="walletAddressDisplay" style="display: none;">
            <span class="wallet-address-label">Connected:</span>
            <span class="wallet-address-value" id="walletAddressValue"></span>
            <button class="wallet-disconnect-btn" onclick="handleDisconnectWallet()" title="Disconnect">âœ•</button>
          </div>
          <div class="wallet-balance-display" id="mewsBalanceDisplay" style="display: none;">
            <span class="wallet-balance-label">$MEWS Balance:</span>
            <span class="wallet-balance-value" id="mewsBalance">--</span>
          </div>
        </div>
        
        <button class="menu-btn primary" id="startGameBtn" onclick="startGame()" onmouseover="playMenuHoverSound()" disabled>
          <span class="btn-icon">â–¶ï¸</span>
          Start Game
        </button>
        <button class="menu-btn" id="startGameTestBtn" onclick="startGameTest()" onmouseover="playMenuHoverSound()" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-color: #ff4444; opacity: 0.5;" title="Test Mode: Bypass gatekeeping (for development/testing)" disabled>
          <span class="btn-icon">ğŸ§ª</span>
          Start Game (Test Mode)
        </button>
        <button class="menu-btn" onclick="showSettings()" onmouseover="playMenuHoverSound()">
          <span class="btn-icon">âš™ï¸</span>
          Settings
        </button>
        <button class="menu-btn" onclick="showInstructions()" onmouseover="playMenuHoverSound()">
          <span class="btn-icon">ğŸ“–</span>
          How to Play
        </button>
        <button class="menu-btn" onclick="showLeaderboard()" onmouseover="playMenuHoverSound()">
          <span class="btn-icon">ğŸ†</span>
          Leaderboard
        </button>
        <button class="menu-btn" onclick="showStore()" onmouseover="playMenuHoverSound()">
          <span class="btn-icon">ğŸ›’</span>
          Store
        </button>
        <button class="menu-btn" onclick="showSoundTest()" onmouseover="playMenuHoverSound()">
          <span class="btn-icon">ğŸ”Š</span>
          Sound Test
        </button>
      </div>
      
      <div class="menu-footer">
        <div class="game-stats">
          <div class="stat-item">
            <span class="stat-label">Best Score:</span>
            <span class="stat-value" id="bestScoreDisplay">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Games Played:</span>
            <span class="stat-value" id="gamesPlayedDisplay">0</span>
          </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Panels as siblings to main menu, inside viewport container -->

    <!-- Sound Test Panel -->
  <div class="sound-test-panel sound-test-panel-hidden" id="soundTestPanel">
    <div class="sound-test-content">
      <div class="sound-test-header">
        <h2>ğŸ”Š Sound Test</h2>
        <button class="close-btn" onclick="hideSoundTest()">âœ•</button>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸµ Game Sounds</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="testSound('shoot')">ğŸ”« Shoot</button>
          <button class="sound-btn" onclick="testSound('enemyHit')">ğŸ’¥ Enemy Hit</button>
          <button class="sound-btn" onclick="testSound('enemyDestroyed')">ğŸ’€ Enemy Destroyed</button>
          <button class="sound-btn" onclick="testSound('coinCollect')">ğŸª™ Coin Collect</button>
          <button class="sound-btn" onclick="testSound('powerupCollect')">âš¡ Power Up</button>
          <button class="sound-btn" onclick="testSound('powerupNegative')">âš ï¸ Power Down</button>
          <button class="sound-btn" onclick="testSound('bossHit')">ğŸ¯ Boss Hit</button>
          <button class="sound-btn" onclick="testSound('bossDestroyed')">ğŸ’€ Boss Destroyed</button>
          <button class="sound-btn" onclick="testSound('gameOver')">ğŸ’€ Game Over</button>
          <button class="sound-btn" onclick="testSound('levelUp')">ğŸ“ˆ Level Up</button>
          <button class="sound-btn" onclick="testSound('playerHit')">ğŸ’¢ Player Hit</button>
        </div>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸ›¡ï¸ Force Field Sounds</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="testForceFieldSound('activate')">ğŸŸ¢ Force Field Activate</button>
          <button class="sound-btn" onclick="testForceFieldSound('powerUp')">ğŸ”µ Force Field Power Up</button>
          <button class="sound-btn" onclick="testForceFieldSound('powerDown')">ğŸŸ¡ Force Field Power Down</button>
          <button class="sound-btn" onclick="testForceFieldSound('destroyed')">ğŸ”´ Force Field Destroyed</button>
        </div>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸ¼ Musical Sequences</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="testSequence('ascending')">ğŸ“ˆ Ascending Sequence</button>
          <button class="sound-btn" onclick="testSequence('descending')">ğŸ“‰ Descending Sequence</button>
          <button class="sound-btn" onclick="testSequence('destruction')">ğŸ’¥ Destruction Sequence</button>
        </div>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸµ Gameplay Music</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="testGameplayMusic()">ğŸ¶ Play Gameplay Music</button>
          <button class="sound-btn" onclick="testBossMusic()">ğŸ‘¹ Play Boss Music</button>
          <button class="sound-btn" onclick="stopBackgroundMusic()">â¹ï¸ Stop Music</button>
        </div>
        
        <h4>ğŸµ Theme Testing</h4>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(1)">ğŸŒŒ Theme 1: Atmospheric</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(2)">âš¡ Theme 2: Driving Action</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(3)">ğŸ”‡ Theme 3: Minimalist</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(4)">ğŸ•¹ï¸ Theme 4: Retro Sci-Fi</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(5)">ğŸš€ Theme 5: Action Packed</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(6)">ğŸ–ï¸ Theme 6: Militaristic</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(7)">âš¡ Theme 7: High Energy</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(8)">ğŸ’¥ Theme 8: Aggressive</button>
        </div>
        
        <h4>ğŸŒ™ Menu Themes (Soothing)</h4>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(9)">ğŸŒ¸ Theme 9: Gentle Ambient</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(10)">ğŸ•Šï¸ Theme 10: Peaceful Melody</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(11)">âœ¨ Theme 11: Soft Harmony</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testTheme(12)">ğŸŒŒ Theme 12: Tranquil Space</button>
        </div>
        
        <h4>ğŸ¼ Instrument Testing</h4>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testInstrument('sine')">ğŸ”” Sine Wave (Pure)</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testInstrument('square')">ğŸ“¦ Square Wave (Digital)</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testInstrument('sawtooth')">ğŸ”º Sawtooth Wave (Buzzy)</button>
          <button class="sound-btn" onclick="if(gameAudio) gameAudio.testInstrument('triangle')">ğŸ”º Triangle Wave (Soft)</button>
        </div>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸ® UI & Feedback Sounds</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="testSound('menuClick')">ğŸ–±ï¸ Menu Click</button>
          <button class="sound-btn" onclick="testSound('menuHover')">ğŸ‘† Menu Hover</button>
          <button class="sound-btn" onclick="testSound('achievement')">ğŸ† Achievement</button>
          <button class="sound-btn" onclick="testSound('warning')">âš ï¸ Warning</button>
          <button class="sound-btn" onclick="testSound('success')">âœ… Success</button>
        </div>
      </div>
      
      <div class="sound-test-section">
        <h3>ğŸ”§ Audio Debug</h3>
        <div class="sound-buttons">
          <button class="sound-btn" onclick="showAudioStats()">ğŸ“Š Audio Stats</button>
          <button class="sound-btn" onclick="testAllSounds()">ğŸµ Test All Sounds</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Settings Panel -->
  <div class="settings-panel settings-panel-hidden" id="settingsPanel">
    <div class="settings-content">
      <div class="settings-header">
        <h2>âš™ï¸ Game Settings</h2>
        <button class="close-btn" onclick="hideSettings()">âœ•</button>
      </div>
      
      <div class="settings-section controls-section">
        <h3>ğŸ® Controls</h3>
        <div class="setting-item">
          <label for="mouseSensitivity">Mouse Sensitivity:</label>
          <input type="range" id="mouseSensitivity" min="0.1" max="0.5" step="0.05" value="0.2">
          <span id="mouseSensitivityValue">0.2</span>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>ğŸ¨ Graphics</h3>
        <div class="setting-item">
          <label for="particleEffects">Particle Effects:</label>
          <input type="checkbox" id="particleEffects" checked>
        </div>
        <div class="setting-item">
          <label for="screenShake">Screen Shake:</label>
          <input type="checkbox" id="screenShake" checked>
        </div>
        <div class="setting-item">
          <label for="trailEffects">Player Trail:</label>
          <input type="checkbox" id="trailEffects" checked>
        </div>
      </div>
      
      <div class="settings-section">
        <h3>ğŸ”Š Audio</h3>
        <div class="setting-item">
          <label for="masterVolume">Master Volume:</label>
          <input type="range" id="masterVolume" min="0" max="100" step="10" value="70">
          <span id="masterVolumeValue">70%</span>
        </div>
        <div class="setting-item">
          <label for="soundEffectsVolume">Sound Effects Volume:</label>
          <input type="range" id="soundEffectsVolume" min="0" max="100" step="10" value="80">
          <span id="soundEffectsVolumeValue">80%</span>
        </div>
        <div class="setting-item">
          <label for="backgroundMusicVolume">Background Music Volume:</label>
          <input type="range" id="backgroundMusicVolume" min="0" max="100" step="10" value="60">
          <span id="backgroundMusicVolumeValue">60%</span>
        </div>
        <div class="setting-item">
          <label for="soundEffects">Sound Effects:</label>
          <input type="checkbox" id="soundEffects" checked>
        </div>
        <div class="setting-item">
          <label for="backgroundMusic">Background Music:</label>
          <input type="checkbox" id="backgroundMusic" checked>
        </div>
      </div>
      
      <div class="settings-buttons">
        <button class="menu-btn" onclick="resetSettings()">Reset to Default</button>
        <button class="menu-btn primary" onclick="saveSettings()">Save Settings</button>
      </div>
    </div>
  </div>

    <!-- Instructions Panel -->
  <div class="instructions-panel instructions-panel-hidden" id="instructionsPanel">
    <div class="instructions-content">
      <div class="instructions-header">
        <h2>ğŸ“– How to Play</h2>
        <button class="close-btn" onclick="hideInstructions()">âœ•</button>
      </div>
      
      <div class="instructions-section">
        <h3>ğŸ¯ Objective</h3>
        <p>Survive as long as possible, defeat bosses, and achieve the highest score!</p>
      </div>
      
      <div class="instructions-section">
        <h3>ğŸ® Controls</h3>
        <div class="control-item">
          <span class="control-icon">ğŸ–±ï¸</span>
          <span class="control-text">Mouse: Move your character vertically</span>
        </div>
        <div class="control-item">
          <span class="control-icon">â¸ï¸</span>
          <span class="control-text">P: Pause/Resume game</span>
        </div>
        <div class="control-item">
          <span class="control-icon">ğŸ”«</span>
          <span class="control-text">Auto-Fire: Your character shoots automatically</span>
        </div>
      </div>
      
      <div class="instructions-section">
        <h3>ğŸ¯ Gameplay</h3>
        <ul>
          <li>Move your character to avoid enemies and collect power-ups</li>
          <li>Collect coins to increase your score</li>
          <li>Pick up green power-ups to increase firepower</li>
          <li>Avoid red power-ups that decrease firepower</li>
          <li>Defeat bosses to progress to higher tiers</li>
          <li>Higher tiers feature stronger enemies and bosses</li>
        </ul>
      </div>
      
      <div class="instructions-section">
        <h3>ğŸ† Scoring</h3>
        <ul>
          <li>Destroy enemies: 15 points Ã— enemy tier</li>
          <li>Collect coins: 10 points each</li>
          <li>Defeat bosses: 5000 points Ã— tier</li>
          <li>Survival bonus: Continuous points based on speed</li>
        </ul>
      </div>
      
      <div class="instructions-buttons">
        <button class="menu-btn primary" onclick="hideInstructions()">Got it!</button>
      </div>
    </div>
  </div>

    <!-- Name input modal -->
    <div class="name-input-modal name-input-modal-hidden" id="nameInputModal">
      <div class="name-input-content">
        <h2>ğŸ‰ New High Score!</h2>
        <div class="score-display">
          Final Score: <span id="finalScoreDisplay">0</span>
        </div>
        <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="20">
        <div class="name-input-buttons">
          <button class="menu-btn primary" onclick="saveScore()">Save Score</button>
          <button class="menu-btn" onclick="skipSave()">Skip</button>
        </div>
      </div>
    </div>

  </div> <!-- End viewport-container -->

  <!-- Load security FIRST -->
  <script src="game-security.js"></script>

  <!-- Note: CSS Loader and Device Detection already loaded in <head> -->

  <!-- Load audio system -->
  <!-- Modular Audio System -->
  <script src="src/game/audio/core/audio-context.js"></script>
  <script src="src/game/audio/settings/audio-settings.js"></script>
  <script src="src/game/audio/music/music-patterns.js"></script>
  <script src="src/game/audio/music/music-composer.js"></script>
  <script src="src/game/audio/music/music-manager.js"></script>
  <script src="src/game/audio/effects/sound-effects.js"></script>
  <script src="src/game/audio/audio-manager.js"></script>
  <script src="src/game/audio/audio-integration.js"></script>

  <!-- Game script -->
    <!-- Modular game scripts -->
    <script src="src/game/rendering/background-images.js"></script>
    <script src="src/game/rendering/player/player-images.js"></script>
    <script src="src/game/rendering/ui/life-images.js"></script>
    <script src="src/game/rendering/collectibles/collectible-images.js"></script>
    <script src="src/game/rendering/enemies/enemy-images.js"></script>
    <script src="src/game/rendering/bosses/boss-images.js"></script>
    <script src="src/game/rendering/projectiles/projectile-images.js"></script>
    <script src="src/game/rendering/effects/particle.js"></script>
    <script src="src/utils/helpers.js"></script>
    <script src="src/game/shared/sprite-metrics.js"></script>
    
    <!-- Mobile Detection Modules (Non-intrusive) -->
    <!-- Note: device-detection.js already loaded in <head> -->
    <script src="src/game/systems/device/device-config.js"></script>
    <script src="src/game/systems/device/device-monitoring.js"></script>
    <script src="src/game/systems/device/landscape-orientation.js"></script>
    <script src="src/game/shared/mobile-utils.js"></script>
    
    <!-- Responsive Rendering Modules -->
    <script src="src/game/rendering/responsive/canvas-manager.js"></script>
    <script src="src/game/rendering/responsive/viewport-manager.js"></script>
    <script src="src/game/rendering/responsive/mobile-ui.js"></script>
    
    <!-- Enhanced Input Modules -->
    <script src="src/game/systems/input/touch-input.js"></script>
    
    <!-- Test mobile detection (non-intrusive) -->
    <script>
      // Test mobile detection without affecting gameplay
      if (typeof DeviceDetection !== 'undefined') {
        console.log('ğŸ” Device Detection Test:', DeviceDetection.getDeviceInfo());
        console.log('ğŸ“± Mobile Utils Test:', MobileUtils.getDeviceInfoString());
      }
      
      // Initialize landscape orientation enforcement
      if (typeof LandscapeOrientation !== 'undefined') {
        LandscapeOrientation.initialize();
      }
      
      // Initialize responsive canvas system
      if (typeof ResponsiveCanvas !== 'undefined' && typeof ViewportManager !== 'undefined') {
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
          const canvas = document.getElementById('gameCanvas');
          if (canvas) {
            ResponsiveCanvas.initialize(canvas);
            ViewportManager.initialize();
            
            // Initialize enhanced touch input
            if (typeof TouchInput !== 'undefined') {
              TouchInput.initialize(canvas);
            }
            
            // Initialize mobile UI system
            if (typeof MobileUI !== 'undefined') {
              MobileUI.initialize();
            }
            
            console.log('ğŸ“ Responsive canvas system initialized');
          }
        });
      }
    </script>
    
    <script src="src/game/main.js"></script>
    
    <!-- Game Systems -->
    <script src="src/game/systems/player/player.js"></script>
    <script src="src/game/systems/bosses/bosses.js"></script>
      <script src="src/game/systems/projectiles/player-projectiles.js"></script>
      <script src="src/game/systems/projectiles/enemy-projectiles.js"></script>
      <script src="src/game/systems/projectiles/boss-projectiles.js"></script>
    <script src="src/game/systems/collision/collision.js"></script>
    <script src="src/game/systems/tiles/tiles.js"></script>
    <script src="src/game/systems/core/scoring.js"></script>
    <script src="src/game/systems/collectibles/collectibles.js"></script>
    <script src="src/game/systems/enemies/enemy-stats.js"></script>
    <script src="src/game/systems/enemies/enemy-behavior.js"></script>
    <script src="src/game/systems/effects/effects.js"></script>
    
    <!-- Rendering modules -->
    <script src="src/game/rendering/ui/ui-rendering.js"></script>
    <script src="src/game/rendering/ui/game-state-rendering.js"></script>
    <script src="src/game/rendering/ui/lives-rendering.js"></script>
    <script src="src/game/rendering/background-rendering.js"></script>
    <script src="src/game/rendering/player/player-rendering.js"></script>
      <script src="src/game/rendering/projectiles/player-projectile-rendering.js"></script>
      <script src="src/game/rendering/projectiles/enemy-projectile-rendering.js"></script>
      <script src="src/game/rendering/projectiles/boss-projectile-rendering.js"></script>
    <script src="src/game/rendering/enemies/enemy-rendering.js"></script>
    <script src="src/game/rendering/collectibles/collectibles-rendering.js"></script>
    <script src="src/game/rendering/bosses/boss-rendering.js"></script>
    <script src="src/game/rendering/effects/effects-rendering.js"></script>
    <script src="src/game/rendering/main-rendering.js"></script>
  
  <!-- UI Management System -->
  <script src="src/game/systems/core/game-state-manager.js"></script>
  <script src="src/game/systems/ui/settings-management.js"></script>
  <script src="src/game/systems/ui/sound-test-system.js"></script>
  <script src="src/game/systems/ui/leaderboard-system.js"></script>
  <script src="src/game/systems/store/item-catalog.js"></script>
  <script src="src/game/systems/store/inventory-manager.js"></script>
  <script src="src/game/systems/store/item-consumption.js"></script>
  <script src="src/game/systems/ui/store-ui.js"></script>
  <script src="src/game/systems/ui/toast-notifications.js"></script>
  <script src="src/game/systems/consumables/consumable-system.js"></script>
  <script src="src/game/systems/consumables/coin-tractor-beam.js"></script>
  <script src="src/game/systems/consumables/slow-time.js"></script>
  <script src="src/game/systems/consumables/destroy-all.js"></script>
  <script src="src/game/systems/consumables/boss-kill-shot.js"></script>
  <script src="src/game/blockchain/score-submission.js"></script>
  <!-- Wallet API Bundle - Includes React and ReactDOM -->
  <!-- React is bundled WITH the wallet module to ensure proper initialization -->
  <script src="wallet-module/dist/wallet-api.umd.cjs" onload="
    (function() {
      console.log('âœ… Wallet bundle loaded');
      
      // React and ReactDOM are exposed by the bundle
      if (typeof window.WalletAPI !== 'undefined') {
        console.log('âœ… WalletAPI available:', typeof window.WalletAPI);
        
        // React and ReactDOM should already be on globalThis from the bundle
        if (typeof globalThis.React !== 'undefined') {
          console.log('âœ… React available on globalThis:', typeof globalThis.React);
        }
        if (typeof globalThis.ReactDOM !== 'undefined') {
          console.log('âœ… ReactDOM available on globalThis:', typeof globalThis.ReactDOM);
        }
        
        // Initialize wallet API
        if (typeof window.WalletAPI.initialize === 'function') {
          window.WalletAPI.initialize().then((api) => {
            console.log('âœ… Wallet API initialized:', api);
            window.walletAPI = api;
          }).catch((error) => {
            console.error('âŒ Failed to initialize wallet API:', error);
          });
        }
      } else {
        console.error('âŒ WalletAPI not found after bundle load');
      }
    })();
  "></script>
  <script>
    // Wallet API is loaded via script tag above
    // This script just ensures it's initialized
    (function() {
      // Wallet API should already be loaded, but check if initialization is needed
      if (typeof window.WalletAPI !== 'undefined' && typeof window.WalletAPI.initialize === 'function' && !window.walletAPI) {
        // Initialize if not already done
        window.WalletAPI.initialize().then((api) => {
          console.log('âœ… Wallet API initialized:', api);
          window.walletAPI = api;
        }).catch((error) => {
          console.error('âŒ Failed to initialize wallet API:', error);
        });
      }
    })();
  </script>
  <script src="src/game/systems/ui/menu-system.js"></script>
  <script src="src/game/systems/ui/ui-initialization.js"></script>
  
  <!-- Initialize wallet integration after UI is loaded -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for WalletAPI to be available
      let attempts = 0;
      const maxAttempts = 10;
      
      const checkWalletAPI = setInterval(async function() {
        attempts++;
        
        // Check for WalletAPI - it might be empty initially due to React error
        // But we should check if it gets populated after the error
        if (typeof WalletAPI !== 'undefined') {
          // Check if WalletAPI has initialize method (directly or via default)
          const walletAPI = WalletAPI?.default || WalletAPI;
          
          if (typeof walletAPI === 'object' && walletAPI !== null && typeof walletAPI.initialize === 'function') {
            clearInterval(checkWalletAPI);
            console.log('âœ… WalletAPI loaded');
            
            // Store the correct reference
            window.WalletAPI = walletAPI;
            
            if (typeof initializeWalletIntegration === 'function') {
              await initializeWalletIntegration();
            }
            
            // After initialization, provide manual check instructions
            console.log('%cğŸ” Wallet API Ready', 'color: #4DA2FF; font-size: 16px; font-weight: bold;');
            console.log('Wallet API initialized. Available wallets:', window.walletAPIInstance?.getWallets() || 'Not loaded yet');
            return;
          }
        }
        
        if (attempts >= maxAttempts) {
          clearInterval(checkWalletAPI);
          console.error('âŒ WalletAPI not loaded after', maxAttempts, 'attempts');
          console.log('Available on window:', typeof window.WalletAPI);
          console.log('WalletAPI object:', window.WalletAPI);
          console.log('WalletAPI.default:', window.WalletAPI?.default);
          console.log('React available:', typeof React, typeof ReactDOM);
          console.log('globalThis.React:', typeof globalThis.React);
          console.log('âš ï¸ The wallet bundle failed to load due to React error. Check console for details.');
        }
      }, 500); // Check every 500ms (slower to give bundle time to recover)
    });
  </script>
</body>
</html>